{"ast":null,"code":"import _objectSpread from\"C:/Users/user/OneDrive/Desktop/cht/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useContext,useEffect,useState}from\"react\";import socket from\"../socket\";import{AuthContext}from\"../context/AuthContext\";import API from\"../api\";import\"./Chat.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Chat(){const{user}=useContext(AuthContext);const[friends,setFriends]=useState([]);const[currentFriend,setCurrentFriend]=useState(null);const[message,setMessage]=useState(\"\");const[messages,setMessages]=useState({});const[onlineUsers,setOnlineUsers]=useState([]);// JOIN SOCKET ROOM\nuseEffect(()=>{if(user!==null&&user!==void 0&&user._id){socket.emit(\"join\",user._id);}},[user]);// RECEIVE ONLINE USERS\nuseEffect(()=>{socket.on(\"onlineUsers\",users=>{setOnlineUsers(users);});return()=>socket.off(\"onlineUsers\");},[]);// RECEIVE MESSAGE\nuseEffect(()=>{socket.on(\"receiveMessage\",_ref=>{let{senderId,text}=_ref;setMessages(prev=>_objectSpread(_objectSpread({},prev),{},{[senderId]:[...(prev[senderId]||[]),{senderId,text}]}));});return()=>socket.off(\"receiveMessage\");},[]);// FETCH FRIENDS\nuseEffect(()=>{const fetchFriends=async()=>{const res=await API.get(\"/users\",{headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"token\"))}});setFriends(res.data);};fetchFriends();},[]);const sendMessage=()=>{if(!currentFriend||!message)return;socket.emit(\"sendMessage\",{senderId:user._id,receiverId:currentFriend._id,text:message});setMessages(prev=>_objectSpread(_objectSpread({},prev),{},{[currentFriend._id]:[...(prev[currentFriend._id]||[]),{senderId:user._id,text:message}]}));setMessage(\"\");};const isOnline=id=>onlineUsers.includes(id);return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"friends\",children:[/*#__PURE__*/_jsx(\"h3\",{children:user.username}),friends.map(f=>/*#__PURE__*/_jsxs(\"div\",{className:\"friend \".concat((currentFriend===null||currentFriend===void 0?void 0:currentFriend._id)===f._id?\"active\":\"\"),onClick:()=>setCurrentFriend(f),children:[/*#__PURE__*/_jsx(\"span\",{className:\"status \".concat(isOnline(f._id)?\"online\":\"offline\")}),f.username]},f._id))]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-box\",children:currentFriend?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Chat with \",currentFriend.username]}),/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:(messages[currentFriend._id]||[]).map((m,i)=>/*#__PURE__*/_jsxs(\"p\",{className:m.senderId===user._id?\"me\":\"them\",children:[/*#__PURE__*/_jsxs(\"b\",{children:[m.senderId===user._id?\"You\":currentFriend.username,\":\"]}),\" \",m.text]},i))}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-box\",children:[/*#__PURE__*/_jsx(\"input\",{value:message,onChange:e=>setMessage(e.target.value),placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"Send\"})]})]}):/*#__PURE__*/_jsx(\"h3\",{children:\"Select a friend to start chatting\"})})]});}","map":{"version":3,"names":["useContext","useEffect","useState","socket","AuthContext","API","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Chat","user","friends","setFriends","currentFriend","setCurrentFriend","message","setMessage","messages","setMessages","onlineUsers","setOnlineUsers","_id","emit","on","users","off","_ref","senderId","text","prev","_objectSpread","fetchFriends","res","get","headers","Authorization","concat","localStorage","getItem","data","sendMessage","receiverId","isOnline","id","includes","className","children","username","map","f","onClick","m","i","value","onChange","e","target","placeholder"],"sources":["C:/Users/user/OneDrive/Desktop/cht/client/src/components/Chat.jsx"],"sourcesContent":["import { useContext, useEffect, useState } from \"react\";\r\nimport socket from \"../socket\";\r\nimport { AuthContext } from \"../context/AuthContext\";\r\nimport API from \"../api\";\r\nimport \"./Chat.css\";\r\n\r\nexport default function Chat() {\r\n  const { user } = useContext(AuthContext);\r\n\r\n  const [friends, setFriends] = useState([]);\r\n  const [currentFriend, setCurrentFriend] = useState(null);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [messages, setMessages] = useState({});\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n\r\n  // JOIN SOCKET ROOM\r\n  useEffect(() => {\r\n    if (user?._id) {\r\n      socket.emit(\"join\", user._id);\r\n    }\r\n  }, [user]);\r\n\r\n  // RECEIVE ONLINE USERS\r\n  useEffect(() => {\r\n    socket.on(\"onlineUsers\", (users) => {\r\n      setOnlineUsers(users);\r\n    });\r\n\r\n    return () => socket.off(\"onlineUsers\");\r\n  }, []);\r\n\r\n  // RECEIVE MESSAGE\r\n  useEffect(() => {\r\n    socket.on(\"receiveMessage\", ({ senderId, text }) => {\r\n      setMessages(prev => ({\r\n        ...prev,\r\n        [senderId]: [...(prev[senderId] || []), { senderId, text }]\r\n      }));\r\n    });\r\n\r\n    return () => socket.off(\"receiveMessage\");\r\n  }, []);\r\n\r\n  // FETCH FRIENDS\r\n  useEffect(() => {\r\n    const fetchFriends = async () => {\r\n      const res = await API.get(\"/users\", {\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`\r\n        }\r\n      });\r\n      setFriends(res.data);\r\n    };\r\n    fetchFriends();\r\n  }, []);\r\n\r\n  const sendMessage = () => {\r\n    if (!currentFriend || !message) return;\r\n\r\n    socket.emit(\"sendMessage\", {\r\n      senderId: user._id,\r\n      receiverId: currentFriend._id,\r\n      text: message\r\n    });\r\n\r\n    setMessages(prev => ({\r\n      ...prev,\r\n      [currentFriend._id]: [\r\n        ...(prev[currentFriend._id] || []),\r\n        { senderId: user._id, text: message }\r\n      ]\r\n    }));\r\n\r\n    setMessage(\"\");\r\n  };\r\n\r\n  const isOnline = (id) => onlineUsers.includes(id);\r\n\r\n  return (\r\n    <div className=\"chat-container\">\r\n      \r\n      {/* FRIEND LIST */}\r\n      <div className=\"friends\">\r\n        <h3>{user.username}</h3>\r\n\r\n        {friends.map(f => (\r\n          <div\r\n            key={f._id}\r\n            className={`friend ${currentFriend?._id === f._id ? \"active\" : \"\"}`}\r\n            onClick={() => setCurrentFriend(f)}\r\n          >\r\n            <span className={`status ${isOnline(f._id) ? \"online\" : \"offline\"}`}></span>\r\n            {f.username}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* CHAT AREA */}\r\n      <div className=\"chat-box\">\r\n        {currentFriend ? (\r\n          <>\r\n            <h3>Chat with {currentFriend.username}</h3>\r\n\r\n            <div className=\"messages\">\r\n              {(messages[currentFriend._id] || []).map((m, i) => (\r\n                <p key={i} className={m.senderId === user._id ? \"me\" : \"them\"}>\r\n                  <b>{m.senderId === user._id ? \"You\" : currentFriend.username}:</b>{\" \"}\r\n                  {m.text}\r\n                </p>\r\n              ))}\r\n            </div>\r\n\r\n            <div className=\"input-box\">\r\n              <input\r\n                value={message}\r\n                onChange={e => setMessage(e.target.value)}\r\n                placeholder=\"Type a message...\"\r\n              />\r\n              <button onClick={sendMessage}>Send</button>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <h3>Select a friend to start chatting</h3>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\n"],"mappings":"8HAAA,OAASA,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CACvD,MAAO,CAAAC,MAAM,KAAM,WAAW,CAC9B,OAASC,WAAW,KAAQ,wBAAwB,CACpD,MAAO,CAAAC,GAAG,KAAM,QAAQ,CACxB,MAAO,YAAY,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAEpB,cAAe,SAAS,CAAAC,IAAIA,CAAA,CAAG,CAC7B,KAAM,CAAEC,IAAK,CAAC,CAAGb,UAAU,CAACI,WAAW,CAAC,CAExC,KAAM,CAACU,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACc,aAAa,CAAEC,gBAAgB,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CACxD,KAAM,CAACgB,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACkB,QAAQ,CAAEC,WAAW,CAAC,CAAGnB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAC5C,KAAM,CAACoB,WAAW,CAAEC,cAAc,CAAC,CAAGrB,QAAQ,CAAC,EAAE,CAAC,CAElD;AACAD,SAAS,CAAC,IAAM,CACd,GAAIY,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEW,GAAG,CAAE,CACbrB,MAAM,CAACsB,IAAI,CAAC,MAAM,CAAEZ,IAAI,CAACW,GAAG,CAAC,CAC/B,CACF,CAAC,CAAE,CAACX,IAAI,CAAC,CAAC,CAEV;AACAZ,SAAS,CAAC,IAAM,CACdE,MAAM,CAACuB,EAAE,CAAC,aAAa,CAAGC,KAAK,EAAK,CAClCJ,cAAc,CAACI,KAAK,CAAC,CACvB,CAAC,CAAC,CAEF,MAAO,IAAMxB,MAAM,CAACyB,GAAG,CAAC,aAAa,CAAC,CACxC,CAAC,CAAE,EAAE,CAAC,CAEN;AACA3B,SAAS,CAAC,IAAM,CACdE,MAAM,CAACuB,EAAE,CAAC,gBAAgB,CAAEG,IAAA,EAAwB,IAAvB,CAAEC,QAAQ,CAAEC,IAAK,CAAC,CAAAF,IAAA,CAC7CR,WAAW,CAACW,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACXD,IAAI,MACP,CAACF,QAAQ,EAAG,CAAC,IAAIE,IAAI,CAACF,QAAQ,CAAC,EAAI,EAAE,CAAC,CAAE,CAAEA,QAAQ,CAAEC,IAAK,CAAC,CAAC,EAC3D,CAAC,CACL,CAAC,CAAC,CAEF,MAAO,IAAM5B,MAAM,CAACyB,GAAG,CAAC,gBAAgB,CAAC,CAC3C,CAAC,CAAE,EAAE,CAAC,CAEN;AACA3B,SAAS,CAAC,IAAM,CACd,KAAM,CAAAiC,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAA9B,GAAG,CAAC+B,GAAG,CAAC,QAAQ,CAAE,CAClCC,OAAO,CAAE,CACPC,aAAa,WAAAC,MAAA,CAAYC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CACxD,CACF,CAAC,CAAC,CACF1B,UAAU,CAACoB,GAAG,CAACO,IAAI,CAAC,CACtB,CAAC,CACDR,YAAY,CAAC,CAAC,CAChB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAS,WAAW,CAAGA,CAAA,GAAM,CACxB,GAAI,CAAC3B,aAAa,EAAI,CAACE,OAAO,CAAE,OAEhCf,MAAM,CAACsB,IAAI,CAAC,aAAa,CAAE,CACzBK,QAAQ,CAAEjB,IAAI,CAACW,GAAG,CAClBoB,UAAU,CAAE5B,aAAa,CAACQ,GAAG,CAC7BO,IAAI,CAAEb,OACR,CAAC,CAAC,CAEFG,WAAW,CAACW,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACXD,IAAI,MACP,CAAChB,aAAa,CAACQ,GAAG,EAAG,CACnB,IAAIQ,IAAI,CAAChB,aAAa,CAACQ,GAAG,CAAC,EAAI,EAAE,CAAC,CAClC,CAAEM,QAAQ,CAAEjB,IAAI,CAACW,GAAG,CAAEO,IAAI,CAAEb,OAAQ,CAAC,CACtC,EACD,CAAC,CAEHC,UAAU,CAAC,EAAE,CAAC,CAChB,CAAC,CAED,KAAM,CAAA0B,QAAQ,CAAIC,EAAE,EAAKxB,WAAW,CAACyB,QAAQ,CAACD,EAAE,CAAC,CAEjD,mBACErC,KAAA,QAAKuC,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAG7BxC,KAAA,QAAKuC,SAAS,CAAC,SAAS,CAAAC,QAAA,eACtB1C,IAAA,OAAA0C,QAAA,CAAKpC,IAAI,CAACqC,QAAQ,CAAK,CAAC,CAEvBpC,OAAO,CAACqC,GAAG,CAACC,CAAC,eACZ3C,KAAA,QAEEuC,SAAS,WAAAT,MAAA,CAAY,CAAAvB,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEQ,GAAG,IAAK4B,CAAC,CAAC5B,GAAG,CAAG,QAAQ,CAAG,EAAE,CAAG,CACpE6B,OAAO,CAAEA,CAAA,GAAMpC,gBAAgB,CAACmC,CAAC,CAAE,CAAAH,QAAA,eAEnC1C,IAAA,SAAMyC,SAAS,WAAAT,MAAA,CAAYM,QAAQ,CAACO,CAAC,CAAC5B,GAAG,CAAC,CAAG,QAAQ,CAAG,SAAS,CAAG,CAAO,CAAC,CAC3E4B,CAAC,CAACF,QAAQ,GALNE,CAAC,CAAC5B,GAMJ,CACN,CAAC,EACC,CAAC,cAGNjB,IAAA,QAAKyC,SAAS,CAAC,UAAU,CAAAC,QAAA,CACtBjC,aAAa,cACZP,KAAA,CAAAE,SAAA,EAAAsC,QAAA,eACExC,KAAA,OAAAwC,QAAA,EAAI,YAAU,CAACjC,aAAa,CAACkC,QAAQ,EAAK,CAAC,cAE3C3C,IAAA,QAAKyC,SAAS,CAAC,UAAU,CAAAC,QAAA,CACtB,CAAC7B,QAAQ,CAACJ,aAAa,CAACQ,GAAG,CAAC,EAAI,EAAE,EAAE2B,GAAG,CAAC,CAACG,CAAC,CAAEC,CAAC,gBAC5C9C,KAAA,MAAWuC,SAAS,CAAEM,CAAC,CAACxB,QAAQ,GAAKjB,IAAI,CAACW,GAAG,CAAG,IAAI,CAAG,MAAO,CAAAyB,QAAA,eAC5DxC,KAAA,MAAAwC,QAAA,EAAIK,CAAC,CAACxB,QAAQ,GAAKjB,IAAI,CAACW,GAAG,CAAG,KAAK,CAAGR,aAAa,CAACkC,QAAQ,CAAC,GAAC,EAAG,CAAC,CAAC,GAAG,CACrEI,CAAC,CAACvB,IAAI,GAFDwB,CAGL,CACJ,CAAC,CACC,CAAC,cAEN9C,KAAA,QAAKuC,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxB1C,IAAA,UACEiD,KAAK,CAAEtC,OAAQ,CACfuC,QAAQ,CAAEC,CAAC,EAAIvC,UAAU,CAACuC,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC1CI,WAAW,CAAC,mBAAmB,CAChC,CAAC,cACFrD,IAAA,WAAQ8C,OAAO,CAAEV,WAAY,CAAAM,QAAA,CAAC,MAAI,CAAQ,CAAC,EACxC,CAAC,EACN,CAAC,cAEH1C,IAAA,OAAA0C,QAAA,CAAI,mCAAiC,CAAI,CAC1C,CACE,CAAC,EACH,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}